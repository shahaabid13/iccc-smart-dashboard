import{a as H,b as z}from"./chunk-AW73V55B.js";import{a as K,c as J,d as Q}from"./chunk-CIT4JVC4.js";import{a as V,b as j}from"./chunk-QZJLICHW.js";import{a as G}from"./chunk-SWU2EWNA.js";import{a as Z,b as ee}from"./chunk-XGOAYSH6.js";import{c as R}from"./chunk-3O3MEYGU.js";import"./chunk-GG7DK3VL.js";import"./chunk-457EALQY.js";import{a as W,b as X}from"./chunk-QNMHJO7J.js";import{a as N,f as B,g as F,h as L,k as U}from"./chunk-WAO5ROTU.js";import{S as Y,T as $}from"./chunk-I7RDOML2.js";import{c as q,e as h,g as y,h as P,k as w,m as D,n as I,r as T,s as O,u as A}from"./chunk-NJBGEMB6.js";import{$a as d,Dc as M,Hc as E,Ia as s,Lc as b,Nc as S,Pb as t,Pc as k,Qa as f,Qb as x,Wa as C,nb as c,ob as n,pb as e,qb as u,zb as g}from"./chunk-HNXX6TOF.js";import"./chunk-FDERIQAA.js";function ne(l,a){l&1&&(n(0,"mat-error"),t(1," Device serial number is required "),e())}function ie(l,a){l&1&&u(0,"mat-progress-spinner",24)}function ae(l,a){l&1&&(n(0,"mat-icon"),t(1,"search"),e())}function re(l,a){l&1&&(n(0,"mat-error"),t(1," Location name is required "),e())}function oe(l,a){l&1&&(n(0,"mat-error"),t(1," Approach road name is required "),e())}function le(l,a){l&1&&(n(0,"mat-error"),t(1," Request type is required "),e())}function se(l,a){l&1&&u(0,"mat-progress-spinner",25)}function me(l,a){l&1&&(n(0,"span"),t(1,"Submit Request"),e())}function ce(l,a){l&1&&(n(0,"span"),t(1,"Submitting..."),e())}var te=class l{constructor(a,m,i,o){this.fb=a;this.snackBar=m;this.router=i;this.http=o;this.form=this.fb.group({deviceSerial:["",h.required],newSerial:[""],locationName:["",h.required],approachRoadName:["",h.required],requestType:["",h.required],remarks:[""]}),this.form.get("requestType")?.valueChanges.subscribe(r=>{(r==="SERIAL_UPDATE"||r==="REPLACE")&&this.snackBar.open("Please provide a new serial number for this request type","OK",{duration:3e3,panelClass:["info-snackbar"]})})}form;submitting=!1;fetchingDetails=!1;baseUrl="http://localhost:8080/api/maintenance/requests";deviceBaseUrl="http://localhost:8080/api/devices";requestTypes=[{value:"FAULT",label:"Fault"},{value:"REPAIR",label:"Repair"},{value:"REPLACE",label:"Replace"},{value:"SERIAL_UPDATE",label:"Serial Update"},{value:"MOVE",label:"Move"}];getDeviceDetails(){let a=this.form.get("deviceSerial")?.value?.trim();if(!a){this.snackBar.open("\u26A0\uFE0F Please enter a device serial number first","Close",{duration:3e3,panelClass:["warning-snackbar"]});return}this.fetchingDetails=!0;let m=localStorage.getItem("token");if(!m){this.snackBar.open("\u274C You must log in to fetch device details","Close",{duration:3e3,panelClass:["error-snackbar"]}),this.fetchingDetails=!1;return}let i=new b({Authorization:`Bearer ${m}`,"Content-Type":"application/json"}),o=`${this.deviceBaseUrl}/by-serial/${encodeURIComponent(a)}`;console.log("Fetching device details from:",o),this.http.get(o,{headers:i}).subscribe({next:r=>{this.fetchingDetails=!1,r?(this.form.patchValue({locationName:r.locationName||"",approachRoadName:r.approachRoad||""}),this.snackBar.open("\u2705 Device details loaded successfully!","Close",{duration:3e3,panelClass:["success-snackbar"]}),console.log("Device details loaded:",r)):this.snackBar.open("\u26A0\uFE0F Device found but no location data available","Close",{duration:3e3,panelClass:["warning-snackbar"]})},error:r=>{this.fetchingDetails=!1,console.error("Error fetching device details:",r);let p="\u274C Failed to fetch device details. Please check the serial number.";r.status===404?p="\u274C Device not found. Please check the serial number.":r.status===401?p="\u274C Authentication failed. Please log in again.":r.status===403?p="\u274C You do not have permission to access device details.":r.status===500?p="\u274C Server error while fetching device details.":r.error?.message&&(p=`\u274C ${r.error.message}`),this.snackBar.open(p,"Close",{duration:5e3,panelClass:["error-snackbar"]})}})}onSerialBlur(){let a=this.form.get("deviceSerial")?.value?.trim(),m=this.form.get("locationName")?.value,i=this.form.get("approachRoadName")?.value;a&&(!m||!i)&&setTimeout(()=>{this.getDeviceDetails()},500)}submit(){if(this.form.invalid){this.markFormGroupTouched(),this.snackBar.open("\u26A0\uFE0F Please fill all required fields correctly.","Close",{duration:3e3,panelClass:["warning-snackbar"]});return}let a=localStorage.getItem("token");if(!a){this.snackBar.open("\u274C You must log in before submitting a request.","Close",{duration:3e3,panelClass:["error-snackbar"]});return}this.submitting=!0;let m=new b({Authorization:`Bearer ${a}`,"Content-Type":"application/json"}),i={deviceSerial:this.form.value.deviceSerial.trim(),newSerial:this.form.value.newSerial?.trim()||null,requestType:this.form.value.requestType,locationName:this.form.value.locationName.trim(),approachRoadName:this.form.value.approachRoadName.trim(),remarks:this.form.value.remarks?.trim()||null};console.log("Submitting maintenance request:",i),this.http.post(this.baseUrl,i,{headers:m}).subscribe({next:o=>{this.snackBar.open("\u2705 Maintenance request submitted successfully!","Close",{duration:4e3,panelClass:["success-snackbar"]}),this.submitting=!1,this.form.reset(),this.router.navigate(["/all-requests"])},error:o=>{console.error("Error submitting request:",o);let r="\u274C Failed to submit request. Please try again.";o.status===400?o.error?.message?r=`\u274C ${o.error.message}`:r="\u274C Invalid request data. Please check your inputs.":o.status===401?r="\u274C Authentication failed. Please log in again.":o.status===403?r="\u274C You do not have permission to submit requests.":o.status===404?r="\u274C Device not found. Please check the Device Serial.":o.status===409?r="\u274C A request for this device is already pending.":o.error?.message&&(r=`\u274C ${o.error.message}`),this.snackBar.open(r,"Close",{duration:5e3,panelClass:["error-snackbar"]}),this.submitting=!1}})}cancel(){this.form.dirty&&!window.confirm("You have unsaved changes. Are you sure you want to cancel?")||this.router.navigate(["/dashboard"])}markFormGroupTouched(){Object.keys(this.form.controls).forEach(a=>{this.form.get(a)?.markAsTouched()})}isNewSerialRecommended(){let a=this.form.get("requestType")?.value;return a==="SERIAL_UPDATE"||a==="REPLACE"}getRequestTypeDescription(a){return{FAULT:"Device is faulty and needs attention",REPAIR:"Device needs repair work",REPLACE:"Device needs to be replaced with a new one",SERIAL_UPDATE:"Update device serial number",MOVE:"Relocate device to different location"}[a]||""}static \u0275fac=function(m){return new(m||l)(f(O),f(H),f(R),f(S))};static \u0275cmp=C({type:l,selectors:[["app-maintenance-request"]],decls:79,vars:14,consts:[[1,"maintenance-card"],[3,"ngSubmit","formGroup"],[1,"serial-with-button"],["appearance","outline",1,"full","serial-field"],["matInput","","formControlName","deviceSerial","required","","placeholder","Enter current device serial number",3,"blur"],[4,"ngIf"],["mat-raised-button","","color","accent","type","button",1,"get-details-btn",3,"click","disabled"],["diameter","16","mode","indeterminate","color","primary","class","spinner-small",4,"ngIf"],["appearance","outline",1,"full"],["matInput","","formControlName","newSerial","placeholder","Enter new serial number if applicable"],["matInput","","formControlName","locationName","required","","placeholder","Enter location name"],["matInput","","formControlName","approachRoadName","required","","placeholder","Enter approach road name"],["formControlName","requestType","required",""],["value","FAULT",1,"options-select"],["value","REPAIR",1,"options-select"],["value","REPLACE",1,"options-select"],["value","SERIAL_UPDATE",1,"options-select"],["value","MOVE",1,"options-select"],["matInput","","formControlName","remarks","rows","3","placeholder","Additional notes, description, or reason for request"],[1,"form-actions"],["mat-raised-button","","color","primary","type","submit",1,"submit-btn",3,"disabled"],["diameter","20","mode","indeterminate","color","accent","class","spinner",4,"ngIf"],["mat-stroked-button","","type","button",1,"cancel-btn",3,"click","disabled"],[1,"help-section"],["diameter","16","mode","indeterminate","color","primary",1,"spinner-small"],["diameter","20","mode","indeterminate","color","accent",1,"spinner"]],template:function(m,i){if(m&1&&(n(0,"mat-card",0)(1,"h2"),t(2,"Create Maintenance Request"),e(),n(3,"form",1),g("ngSubmit",function(){return i.submit()}),n(4,"div",2)(5,"mat-form-field",3)(6,"mat-label"),t(7,"Device Serial Number"),e(),n(8,"input",4),g("blur",function(){return i.onSerialBlur()}),e(),d(9,ne,2,0,"mat-error",5),e(),n(10,"button",6),g("click",function(){return i.getDeviceDetails()}),d(11,ie,1,0,"mat-progress-spinner",7)(12,ae,2,0,"mat-icon",5),n(13,"span"),t(14),e()()(),n(15,"mat-form-field",8)(16,"mat-label"),t(17,"New Serial Number (if replacing/updating)"),e(),u(18,"input",9),e(),n(19,"mat-form-field",8)(20,"mat-label"),t(21,"Location Name"),e(),u(22,"input",10),d(23,re,2,0,"mat-error",5),e(),n(24,"mat-form-field",8)(25,"mat-label"),t(26,"Approach Road Name"),e(),u(27,"input",11),d(28,oe,2,0,"mat-error",5),e(),n(29,"mat-form-field",8)(30,"mat-label"),t(31,"Request Type"),e(),n(32,"mat-select",12)(33,"mat-option",13),t(34,"Fault"),e(),n(35,"mat-option",14),t(36,"Repair"),e(),n(37,"mat-option",15),t(38,"Replace"),e(),n(39,"mat-option",16),t(40,"Serial Update"),e(),n(41,"mat-option",17),t(42,"Move"),e()(),d(43,le,2,0,"mat-error",5),e(),n(44,"mat-form-field",8)(45,"mat-label"),t(46,"Remarks"),e(),u(47,"textarea",18),e(),n(48,"div",19)(49,"button",20),d(50,se,1,0,"mat-progress-spinner",21)(51,me,2,0,"span",5)(52,ce,2,0,"span",5),e(),n(53,"button",22),g("click",function(){return i.cancel()}),t(54," Cancel "),e()(),n(55,"div",23)(56,"h4"),t(57,"Request Type Descriptions:"),e(),n(58,"ul")(59,"li")(60,"strong"),t(61,"FAULT"),e(),t(62," - Device is faulty and needs attention"),e(),n(63,"li")(64,"strong"),t(65,"REPAIR"),e(),t(66," - Device needs repair work"),e(),n(67,"li")(68,"strong"),t(69,"REPLACE"),e(),t(70," - Device needs to be replaced with a new one"),e(),n(71,"li")(72,"strong"),t(73,"SERIAL_UPDATE"),e(),t(74," - Update device serial number"),e(),n(75,"li")(76,"strong"),t(77,"MOVE"),e(),t(78," - Relocate device to different location"),e()()()()()),m&2){let o,r,p,v,_;s(3),c("formGroup",i.form),s(6),c("ngIf",(o=i.form.get("deviceSerial"))==null?null:o.hasError("required")),s(),c("disabled",!((r=i.form.get("deviceSerial"))!=null&&r.value)||i.fetchingDetails),s(),c("ngIf",i.fetchingDetails),s(),c("ngIf",!i.fetchingDetails),s(2),x(i.fetchingDetails?"Fetching...":"Get Details"),s(9),c("ngIf",(p=i.form.get("locationName"))==null?null:p.hasError("required")),s(5),c("ngIf",(v=i.form.get("approachRoadName"))==null?null:v.hasError("required")),s(15),c("ngIf",(_=i.form.get("requestType"))==null?null:_.hasError("required")),s(6),c("disabled",i.form.invalid||i.submitting),s(),c("ngIf",i.submitting),s(),c("ngIf",!i.submitting),s(),c("ngIf",i.submitting),s(),c("disabled",i.submitting)}},dependencies:[E,M,A,w,q,y,P,T,D,I,G,U,F,L,j,V,$,Y,B,N,z,ee,Z,Q,J,K,k,X,W],styles:[".maintenance-card[_ngcontent-%COMP%]{max-width:600px;margin:40px auto;padding:28px;border-radius:12px;box-shadow:0 6px 16px #00000026;background:#fafafa}h2[_ngcontent-%COMP%]{text-align:center;color:#1565c0;font-weight:600;margin-bottom:28px;letter-spacing:.5px}.full[_ngcontent-%COMP%]{width:100%;margin-bottom:18px}.serial-with-button[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:flex-start}.serial-field[_ngcontent-%COMP%]{flex:1}.options-select[_ngcontent-%COMP%]{text-color:#6610f2;font-weight:500;background-color:#f8f9fa!important}.get-details-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;height:56px;margin-top:.25em;white-space:nowrap;min-width:140px;font-weight:500;background:linear-gradient(135deg,#ff9800,#f57c00);color:#fff}.get-details-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(135deg,#f57c00,#ef6c00);transform:translateY(-1px);box-shadow:0 4px 8px #f57c004d}.get-details-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed;transform:none}.spinner-small[_ngcontent-%COMP%]{margin-right:4px}mat-form-field[_ngcontent-%COMP%]{font-size:15px}.form-actions[_ngcontent-%COMP%]{display:flex;gap:12px;margin-top:20px;margin-bottom:30px}.submit-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px;flex:1;font-weight:600;height:48px;border-radius:8px;letter-spacing:.5px;transition:all .3s ease}.cancel-btn[_ngcontent-%COMP%]{flex:.5;height:48px;border-radius:8px;font-weight:500}.submit-btn[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#1565c0;transform:translateY(-1px);box-shadow:0 4px 8px #1565c04d}.submit-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed;transform:none}.cancel-btn[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#f5f5f5}.spinner[_ngcontent-%COMP%]{margin-right:8px}.help-section[_ngcontent-%COMP%]{background:#e3f2fd;padding:16px;border-radius:8px;border-left:4px solid #2196f3;margin-top:20px}.help-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 12px;color:#1565c0;font-weight:600}.help-section[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:0;padding-left:20px}.help-section[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:8px;line-height:1.4}.help-section[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#1976d2}  .mat-form-field-appearance-outline .mat-form-field-outline{background-color:#fff!important;border-radius:4px!important}  .mat-form-field-appearance-outline.mat-form-field-disabled .mat-form-field-outline{background-color:#f5f5f5!important}  .mat-select-panel{background:#fff!important;border:2px solid #e0e0e0!important;border-radius:8px!important}  .mat-option{background:#fff!important;color:#333!important;font-weight:500}  .mat-option:hover:not(.mat-option-disabled){background:#f0f8ff!important;color:#1976d2!important}  .mat-option.mat-selected:not(.mat-option-multiple){background:#e3f2fd!important;color:#1976d2!important;font-weight:600}  .mat-option.mat-active{background:#e3f2fd!important;color:#1976d2!important}  .mat-form-field-appearance-outline .mat-form-field-outline-thick{color:#e0e0e0!important}  .mat-input-element{background-color:transparent!important}  textarea.mat-input-element{background-color:transparent!important}  .success-snackbar{background:#4caf50!important;color:#fff!important}  .error-snackbar{background:#f44336!important;color:#fff!important}  .warning-snackbar{background:#ff9800!important;color:#fff!important}  .info-snackbar{background:#2196f3!important;color:#fff!important}@media (max-width: 768px){.maintenance-card[_ngcontent-%COMP%]{margin:20px;padding:20px}.serial-with-button[_ngcontent-%COMP%]{flex-direction:column;gap:8px}.get-details-btn[_ngcontent-%COMP%]{width:100%;height:48px;margin-top:0}.form-actions[_ngcontent-%COMP%]{flex-direction:column}.cancel-btn[_ngcontent-%COMP%]{flex:1}}"]})};export{te as MaintenanceRequestComponent};
