import{a as et,b as nt}from"./chunk-7TRSEXU6.js";import{a as Z,b as tt}from"./chunk-XGOAYSH6.js";import{a as N,b as $,c as B,d as V,e as j,f as U,g as F,h as K,i as Q,j as W,k as q,l as X,m as Y}from"./chunk-QKMXXL45.js";import{a as w,c as T}from"./chunk-3O3MEYGU.js";import"./chunk-GG7DK3VL.js";import"./chunk-457EALQY.js";import{a as G,b as J}from"./chunk-QNMHJO7J.js";import{a as H,c as A,f as k}from"./chunk-WAO5ROTU.js";import{Q as R,S as z,T as L}from"./chunk-I7RDOML2.js";import"./chunk-NJBGEMB6.js";import{$a as m,Bb as d,Bc as D,Dc as P,Hc as E,Ia as r,Nb as S,Nc as O,Pb as a,Qa as x,Qb as s,Rb as _,Wa as b,fa as y,ga as M,nb as l,ob as o,pb as i,qb as v,ub as f,vb as g,xb as I,zb as u}from"./chunk-HNXX6TOF.js";import{a as C,b as h}from"./chunk-FDERIQAA.js";function dt(e,n){if(e&1&&(o(0,"mat-card",13)(1,"mat-card-content")(2,"div",14)(3,"div",15)(4,"span",16),a(5,"Current Serial:"),i(),o(6,"span",17),a(7),i()(),o(8,"div",15)(9,"span",16),a(10,"Device Type:"),i(),o(11,"span",18),a(12),i()(),o(13,"div",15)(14,"span",16),a(15,"Current Location:"),i(),o(16,"span",18),a(17),i()(),o(18,"div",15)(19,"span",16),a(20,"Status:"),i(),o(21,"mat-chip",19),a(22),i()()()()()),e&2){let t=d();r(7),s(t.deviceInfo.currentSerial||"N/A"),r(5),s(t.deviceInfo.deviceType||"N/A"),r(5),s(t.deviceInfo.currentLocation||"N/A"),r(4),l("ngClass",t.getStatusClass(t.deviceInfo.status)),r(),_(" ",t.deviceInfo.status||"UNKNOWN"," ")}}function st(e,n){e&1&&(o(0,"div",20),v(1,"mat-progress-spinner",21),o(2,"p",22),a(3,"Loading device history..."),i()())}function mt(e,n){e&1&&(o(0,"th",38),a(1,"Action"),i())}function pt(e,n){if(e&1&&(o(0,"td",39)(1,"mat-chip",40),a(2),i()()),e&2){let t=n.$implicit,c=d(2);r(),l("ngClass",c.getActionClass(t.action)),r(),_(" ",t.action," ")}}function ft(e,n){e&1&&(o(0,"th",38),a(1,"Serial Changes"),i())}function gt(e,n){if(e&1&&(o(0,"span",46),a(1),i()),e&2){let t=d().$implicit;r(),s(t.oldSerial)}}function _t(e,n){e&1&&(o(0,"mat-icon",47),a(1,"arrow_forward"),i())}function xt(e,n){if(e&1&&(o(0,"span",48),a(1),i()),e&2){let t=d().$implicit;r(),s(t.newSerial)}}function vt(e,n){e&1&&(o(0,"span",49),a(1,"-"),i())}function ut(e,n){if(e&1&&(o(0,"td",39)(1,"div",41),m(2,gt,2,1,"span",42)(3,_t,2,0,"mat-icon",43)(4,xt,2,1,"span",44)(5,vt,2,0,"span",45),i()()),e&2){let t=n.$implicit;r(2),l("ngIf",t.oldSerial),r(),l("ngIf",t.oldSerial&&t.newSerial),r(),l("ngIf",t.newSerial),r(),l("ngIf",!t.oldSerial&&!t.newSerial)}}function Ct(e,n){e&1&&(o(0,"th",38),a(1,"Location Changes"),i())}function ht(e,n){if(e&1&&(o(0,"span",46),a(1),i()),e&2){let t=d().$implicit;r(),s(t.oldLocation)}}function yt(e,n){e&1&&(o(0,"mat-icon",47),a(1,"arrow_forward"),i())}function Mt(e,n){if(e&1&&(o(0,"span",48),a(1),i()),e&2){let t=d().$implicit;r(),s(t.newLocation)}}function bt(e,n){e&1&&(o(0,"span",49),a(1,"-"),i())}function It(e,n){if(e&1&&(o(0,"td",39)(1,"div",41),m(2,ht,2,1,"span",42)(3,yt,2,0,"mat-icon",43)(4,Mt,2,1,"span",44)(5,bt,2,0,"span",45),i()()),e&2){let t=n.$implicit;r(2),l("ngIf",t.oldLocation),r(),l("ngIf",t.oldLocation&&t.newLocation),r(),l("ngIf",t.newLocation),r(),l("ngIf",!t.oldLocation&&!t.newLocation)}}function St(e,n){e&1&&(o(0,"th",38),a(1,"Additional Info"),i())}function Dt(e,n){if(e&1&&(o(0,"div",53)(1,"mat-icon",54),a(2,"device_replace"),i(),a(3),i()),e&2){let t=d().$implicit;r(3),_(" Replaced: ",t.replacedDeviceSerial," ")}}function Pt(e,n){if(e&1&&(o(0,"div",53)(1,"mat-icon",54),a(2,"receipt"),i(),a(3),i()),e&2){let t=d().$implicit;r(3),_(" Ref: ",t.referenceId," ")}}function Et(e,n){e&1&&(o(0,"div",55),a(1," - "),i())}function Ot(e,n){if(e&1&&(o(0,"td",39)(1,"div",50),m(2,Dt,4,1,"div",51)(3,Pt,4,1,"div",51)(4,Et,2,0,"div",52),i()()),e&2){let t=n.$implicit;r(2),l("ngIf",t.replacedDeviceSerial),r(),l("ngIf",t.referenceId),r(),l("ngIf",!t.replacedDeviceSerial&&!t.referenceId)}}function wt(e,n){e&1&&(o(0,"th",38),a(1,"Timestamp"),i())}function Tt(e,n){if(e&1&&(o(0,"td",39)(1,"div",56)(2,"div",57),a(3),i(),o(4,"div",58),a(5),i()()()),e&2){let t=n.$implicit,c=d(2);r(3),s(c.formatDate(t.createdAt)),r(2),s(c.formatTime(t.createdAt))}}function Ht(e,n){e&1&&(o(0,"th",38),a(1,"Performed By"),i())}function At(e,n){if(e&1&&(o(0,"td",39)(1,"div",59)(2,"mat-icon",60),a(3,"person"),i(),a(4),i()()),e&2){let t=n.$implicit;r(4),_(" ",t.performedBy||"System"," ")}}function kt(e,n){e&1&&v(0,"tr",61)}function Rt(e,n){if(e&1&&v(0,"tr",62),e&2){let t=n.$implicit,c=d(2);S("recent-row",c.isRecent(t.createdAt))}}function zt(e,n){if(e&1&&(o(0,"div",23)(1,"div",24)(2,"h3"),a(3,"Activity Timeline"),i(),o(4,"span",25),a(5),i()(),o(6,"div",26)(7,"table",27),f(8,28),m(9,mt,2,0,"th",29)(10,pt,3,2,"td",30),g(),f(11,31),m(12,ft,2,0,"th",29)(13,ut,6,4,"td",30),g(),f(14,32),m(15,Ct,2,0,"th",29)(16,It,6,4,"td",30),g(),f(17,33),m(18,St,2,0,"th",29)(19,Ot,5,3,"td",30),g(),f(20,34),m(21,wt,2,0,"th",29)(22,Tt,6,2,"td",30),g(),f(23,35),m(24,Ht,2,0,"th",29)(25,At,5,1,"td",30),g(),m(26,kt,1,0,"tr",36)(27,Rt,1,2,"tr",37),i()()()),e&2){let t=d();r(5),_("",t.history.length," records found"),r(2),l("dataSource",t.history),r(19),l("matHeaderRowDef",t.displayedColumns),r(),l("matRowDefColumns",t.displayedColumns)}}function Lt(e,n){if(e&1){let t=I();o(0,"div",63)(1,"mat-icon",64),a(2,"history"),i(),o(3,"h3"),a(4,"No History Available"),i(),o(5,"p"),a(6,"No activity records found for this device."),i(),o(7,"button",65),u("click",function(){y(t);let p=d();return M(p.reload())}),o(8,"mat-icon"),a(9,"refresh"),i(),a(10," Check Again "),i()()}}function Nt(e,n){if(e&1&&(o(0,"div",66)(1,"mat-card",67)(2,"mat-card-content")(3,"h4"),a(4,"Quick Stats"),i(),o(5,"div",68)(6,"div",69)(7,"span",70),a(8),i(),o(9,"span",71),a(10,"Total Actions"),i()(),o(11,"div",69)(12,"span",70),a(13),i(),o(14,"span",71),a(15,"Installations"),i()(),o(16,"div",69)(17,"span",70),a(18),i(),o(19,"span",71),a(20,"Repairs"),i()(),o(21,"div",69)(22,"span",70),a(23),i(),o(24,"span",71),a(25,"Replacements"),i()()()()()()),e&2){let t=d();r(8),s(t.getTotalActions()),r(5),s(t.getActionCount("INSTALL")),r(5),s(t.getActionCount("REPAIR")),r(5),s(t.getActionCount("REPLACE"))}}var it=class e{constructor(n,t,c){this.route=n;this.http=t;this.router=c}history=[];deviceInfo=null;displayedColumns=["action","serialChanges","locationChanges","additionalInfo","timestamp","performedBy"];loading=!1;ngOnInit(){let n=this.route.snapshot.paramMap.get("deviceId");n&&(this.loadHistory(n),this.loadDeviceInfo(n))}loadHistory(n){this.loading=!0,this.http.get(`http://localhost:8080/api/history/device/${n}`).subscribe({next:t=>{this.history=(t||[]).map(c=>h(C({},c),{createdAt:this.parseCustomDate(c.createdAt)})).sort((c,p)=>new Date(p.createdAt).getTime()-new Date(c.createdAt).getTime()),this.loading=!1},error:t=>{console.error("Failed to load history:",t),this.loading=!1}})}parseCustomDate(n){if(!n)return new Date;try{if(typeof n=="string"&&n.includes(",")){let t=n.split(",").map(c=>parseInt(c,10));if(t.length>=6){let c=t[0],p=t[1]-1,ot=t[2],at=t[3],rt=t[4],ct=t[5],lt=t[6]||0;return new Date(c,p,ot,at,rt,ct,lt/1e6)}}return new Date(n)}catch(t){return console.warn("Failed to parse date:",n,t),new Date}}formatDate(n){return this.parseCustomDate(n).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}formatTime(n){return this.parseCustomDate(n).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}loadDeviceInfo(n){this.http.get(`http://localhost:8080/api/devices/${n}`).subscribe({next:t=>{this.deviceInfo=t},error:t=>{console.error("Failed to load device info:",t)}})}getActionClass(n){return{INSTALL:"action-install",REPAIR:"action-repair",REPLACE:"action-replace",UPDATE:"action-update",MOVE:"action-move",SERIAL_UPDATE:"action-update"}[n]||"action-update"}getStatusClass(n){return{ACTIVE:"status-active",INACTIVE:"status-inactive",MAINTENANCE:"status-maintenance",INSTALLED:"status-active"}[n]||"status-inactive"}isRecent(n){let t=this.parseCustomDate(n);return(new Date().getTime()-t.getTime())/(1e3*60*60)<24}getTotalActions(){return this.history.length}getActionCount(n){return this.history.filter(t=>t.action===n).length}reload(){let n=this.route.snapshot.paramMap.get("deviceId");n&&(this.loadHistory(n),this.loadDeviceInfo(n))}goBack(){this.router.navigate(["/inventory"])}static \u0275fac=function(t){return new(t||e)(x(w),x(O),x(T))};static \u0275cmp=b({type:e,selectors:[["app-device-history"]],decls:21,vars:5,consts:[[1,"page-container"],[1,"history-card","mat-elevation-z8"],[1,"header-section"],[1,"header-content"],["mat-icon-button","","matTooltip","Back to Inventory",1,"back-btn",3,"click"],[1,"title-section"],[1,"subtitle"],["mat-raised-button","","color","primary",1,"refresh-btn",3,"click"],["class","device-summary-card",4,"ngIf"],["class","loading-container",4,"ngIf"],["class","table-section",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","stats-section",4,"ngIf"],[1,"device-summary-card"],[1,"device-info-grid"],[1,"device-info-item"],[1,"label"],[1,"value","serial"],[1,"value"],[1,"status-chip",3,"ngClass"],[1,"loading-container"],["mode","indeterminate","color","primary","diameter","60"],[1,"loading-text"],[1,"table-section"],[1,"table-header"],[1,"record-count"],[1,"table-container"],["mat-table","",1,"history-table",3,"dataSource"],["matColumnDef","action"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","serialChanges"],["matColumnDef","locationChanges"],["matColumnDef","additionalInfo"],["matColumnDef","timestamp"],["matColumnDef","performedBy"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"recent-row",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[1,"action-chip",3,"ngClass"],[1,"change-comparison"],["class","old-value",4,"ngIf"],["class","change-arrow",4,"ngIf"],["class","new-value",4,"ngIf"],["class","no-change",4,"ngIf"],[1,"old-value"],[1,"change-arrow"],[1,"new-value"],[1,"no-change"],[1,"additional-info"],["class","info-item",4,"ngIf"],["class","no-info",4,"ngIf"],[1,"info-item"],[1,"info-icon"],[1,"no-info"],[1,"timestamp"],[1,"date"],[1,"time"],[1,"performed-by"],[1,"user-icon"],["mat-header-row",""],["mat-row",""],[1,"empty-state"],[1,"empty-icon"],["mat-raised-button","","color","primary",3,"click"],[1,"stats-section"],[1,"stats-card"],[1,"stats-grid"],[1,"stat-item"],[1,"stat-number"],[1,"stat-label"]],template:function(t,c){t&1&&(o(0,"div",0)(1,"mat-card",1)(2,"div",2)(3,"div",3)(4,"button",4),u("click",function(){return c.goBack()}),o(5,"mat-icon"),a(6,"arrow_back"),i()(),o(7,"div",5)(8,"h1"),a(9,"Device History"),i(),o(10,"p",6),a(11,"Complete audit trail for device activities"),i()()(),o(12,"button",7),u("click",function(){return c.reload()}),o(13,"mat-icon"),a(14,"refresh"),i(),a(15," Refresh "),i()(),m(16,dt,23,5,"mat-card",8)(17,st,4,0,"div",9)(18,zt,28,4,"div",10)(19,Lt,11,0,"div",11)(20,Nt,26,4,"div",12),i()()),t&2&&(r(16),l("ngIf",c.deviceInfo),r(),l("ngIf",c.loading),r(),l("ngIf",!c.loading&&c.history.length>0),r(),l("ngIf",!c.loading&&c.history.length===0),r(),l("ngIf",!c.loading&&c.history.length>0))},dependencies:[E,D,P,q,N,B,F,V,$,K,j,U,Q,W,k,H,A,L,z,R,tt,Z,J,G,nt,et,Y,X],styles:[".page-container[_ngcontent-%COMP%]{padding:20px;background:#f5f7fa;min-height:100vh}.history-card[_ngcontent-%COMP%]{border-radius:16px;overflow:hidden;background:#fff}.header-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:24px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}.header-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.back-btn[_ngcontent-%COMP%]{color:#fff;background:#fff3}.title-section[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:28px;font-weight:700;letter-spacing:-.5px}.subtitle[_ngcontent-%COMP%]{margin:4px 0 0;opacity:.9;font-size:14px}.refresh-btn[_ngcontent-%COMP%]{background:#fff3;color:#fff;border:1px solid rgba(255,255,255,.3)}.device-summary-card[_ngcontent-%COMP%]{margin:20px 24px;border-left:4px solid #667eea}.device-info-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px}.device-info-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.label[_ngcontent-%COMP%]{font-size:12px;color:#666;text-transform:uppercase;font-weight:600}.value[_ngcontent-%COMP%]{font-size:16px;font-weight:500;color:#333}.serial[_ngcontent-%COMP%]{color:#667eea;font-weight:600}.status-chip[_ngcontent-%COMP%]{font-weight:600;text-transform:uppercase;font-size:11px}.status-active[_ngcontent-%COMP%]{background:#4caf50!important;color:#fff!important}.status-inactive[_ngcontent-%COMP%]{background:#f44336!important;color:#fff!important}.status-maintenance[_ngcontent-%COMP%]{background:#ff9800!important;color:#fff!important}.loading-container[_ngcontent-%COMP%]{text-align:center;padding:60px 20px}.loading-text[_ngcontent-%COMP%]{margin-top:16px;color:#666;font-size:16px}.table-section[_ngcontent-%COMP%]{padding:0 24px 24px}.table-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.table-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#333;font-size:20px;font-weight:600}.record-count[_ngcontent-%COMP%]{background:#e3f2fd;color:#1976d2;padding:6px 12px;border-radius:16px;font-size:12px;font-weight:600}.table-container[_ngcontent-%COMP%]{border:1px solid #e0e0e0;border-radius:12px;overflow:hidden}.history-table[_ngcontent-%COMP%]{width:100%}th.mat-header-cell[_ngcontent-%COMP%]{background:#f8f9fa;font-weight:600;color:#333;font-size:13px;text-transform:uppercase;letter-spacing:.5px;padding:16px;border-bottom:2px solid #e0e0e0}td.mat-cell[_ngcontent-%COMP%]{padding:16px;border-bottom:1px solid #f0f0f0;vertical-align:top}.action-chip[_ngcontent-%COMP%]{font-weight:600;text-transform:uppercase;font-size:11px}.action-install[_ngcontent-%COMP%]{background:#4caf50!important;color:#fff!important}.action-repair[_ngcontent-%COMP%]{background:#ff9800!important;color:#fff!important}.action-replace[_ngcontent-%COMP%]{background:#2196f3!important;color:#fff!important}.action-update[_ngcontent-%COMP%]{background:#9c27b0!important;color:#fff!important}.action-move[_ngcontent-%COMP%]{background:#607d8b!important;color:#fff!important}.change-comparison[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;flex-wrap:wrap}.old-value[_ngcontent-%COMP%]{background:#ffebee;color:#c62828;padding:4px 8px;border-radius:4px;font-size:12px;text-decoration:line-through}.new-value[_ngcontent-%COMP%]{background:#e8f5e8;color:#2e7d32;padding:4px 8px;border-radius:4px;font-size:12px;font-weight:600}.change-arrow[_ngcontent-%COMP%]{font-size:16px;color:#666}.no-change[_ngcontent-%COMP%]{color:#999;font-style:italic}.additional-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.info-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;font-size:12px;color:#666}.info-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px}.timestamp[_ngcontent-%COMP%]{text-align:center}.date[_ngcontent-%COMP%]{font-weight:600;color:#333;font-size:13px}.time[_ngcontent-%COMP%]{color:#666;font-size:11px}.performed-by[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;font-size:13px}.user-icon[_ngcontent-%COMP%]{font-size:18px;color:#666}.recent-row[_ngcontent-%COMP%]{background:#f3f8ff!important;border-left:3px solid #2196f3}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:60px 20px;color:#666}.empty-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px;color:#bdbdbd;margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 8px;color:#333}.stats-section[_ngcontent-%COMP%]{padding:0 24px 24px}.stats-card[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}.stats-card[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 16px;color:#fff;text-align:center}.stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:16px}.stat-item[_ngcontent-%COMP%]{text-align:center}.stat-number[_ngcontent-%COMP%]{display:block;font-size:24px;font-weight:700;margin-bottom:4px}.stat-label[_ngcontent-%COMP%]{font-size:12px;opacity:.9;text-transform:uppercase}@media (max-width: 768px){.page-container[_ngcontent-%COMP%]{padding:10px}.header-section[_ngcontent-%COMP%]{flex-direction:column;gap:16px;text-align:center}.header-content[_ngcontent-%COMP%]{flex-direction:column}.device-info-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.displayed-columns[_ngcontent-%COMP%]{font-size:12px}th.mat-header-cell[_ngcontent-%COMP%], td.mat-cell[_ngcontent-%COMP%]{padding:12px 8px}.stats-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}"]})};export{it as DeviceHistoryComponent};
